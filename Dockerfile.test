# ‚úÖ –ë–∞–∑–æ–≤—ã–π –±–µ–∑–æ–ø–∞—Å–Ω—ã–π –æ–±—Ä–∞–∑ Python
FROM python:3.13-slim

# üìå –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Å–∏—Å—Ç–µ–º—ã –∏ —É—Å—Ç–∞–Ω–æ–≤–∫–∞ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π
RUN apt-get update && apt-get install -y \
    curl \
    wget \
    unzip \
    git \
    nodejs \
    npm \
    openjdk-17-jre-headless \
    && apt-get clean \
    && rm -rf /var/lib/apt/lists/*

# ‚úÖ –£—Å—Ç–∞–Ω–æ–≤–∫–∞ Playwright –¥–ª—è Python
RUN pip install --no-cache-dir pytest pytest-playwright allure-pytest

# üì¶ –£—Å—Ç–∞–Ω–æ–≤–∫–∞ –±—Ä–∞—É–∑–µ—Ä–æ–≤ Playwright (headless Chromium, Firefox, WebKit)
RUN python -m playwright install --with-deps

# ‚úÖ –£—Å—Ç–∞–Ω–æ–≤–∫–∞ Allure CLI (–∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∞ —Å—Å—ã–ª–∫–∞)
RUN wget https://github.com/allure-framework/allure2/releases/download/2.34.0/allure-2.34.0.zip \
    && unzip allure-2.34.0.zip -d /opt/ \
    && mv /opt/allure-2.34.0 /opt/allure \
    && ln -s /opt/allure/bin/allure /usr/bin/allure \
    && rm allure-2.34.0.zip

# ‚úÖ –†–∞–±–æ—á–∞—è –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏—è
WORKDIR /tests

# üîÅ –ö–æ–ø–∏—Ä—É–µ–º –ø—Ä–æ–µ–∫—Ç –≤ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä
COPY . .

# üõ†Ô∏è –£—Å—Ç–∞–Ω–æ–≤–∫–∞ node –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π, –µ—Å–ª–∏ –µ—Å—Ç—å —Ñ—Ä–æ–Ω—Ç/—Å–µ—Ä–≤–µ—Ä
RUN if [ -f package.json ]; then npm install; fi

# üìù –î–µ–ª–∞–µ–º —Å–∫—Ä–∏–ø—Ç –∏—Å–ø–æ–ª–Ω—è–µ–º—ã–º
RUN chmod +x run_tests.sh

# üß™ –¢–æ—á–∫–∞ –≤—Ö–æ–¥–∞ ‚Äî –∑–∞–ø—É—Å–∫ —Ç–µ—Å—Ç–æ–≤ –∏ –≥–µ–Ω–µ—Ä–∞—Ü–∏—è –æ—Ç—á–µ—Ç–∞
CMD ["./run_tests.sh"]